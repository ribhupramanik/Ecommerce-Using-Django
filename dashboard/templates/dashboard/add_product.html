{% extends "base.html" %}

{% block title %}Add Product{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-12 bg-white p-8 rounded-xl shadow">

    <h2 class="text-2xl font-semibold mb-6">Add New Product</h2>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <!-- Product Name -->
        <div>
            <label class="block font-medium text-gray-700 mb-1">Product Name</label>
            <input type="text" name="name"
                   value="{{ form.name.value|default:'' }}"
                   class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Description -->
        <div>
            <label class="block font-medium text-gray-700 mb-1">Description</label>
            <textarea name="description"
                      rows="4"
                      class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500">{{ form.description.value|default:'' }}</textarea>
        </div>

        <!-- Price -->
        <div>
            <label class="block font-medium text-gray-700 mb-1">Price</label>
            <input type="number" step="0.01" name="price"
                   value="{{ form.price.value|default:'' }}"
                   class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Stock -->
        <div>
            <label class="block font-medium text-gray-700 mb-1">Stock</label>
            <input type="number" name="stock"
                   value="{{ form.stock.value|default:0 }}"
                   class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Product Images -->
        <div>
            <label class="block font-medium text-gray-700 mb-2">Product Images</label>
            
            <input type="file" id="imageInput" name="images" multiple
                   class="w-full text-sm text-gray-600 border border-gray-300 rounded p-2">

            <p class="text-xs text-gray-500 mt-1">You can upload multiple images</p>

            <!-- Preview Section -->
            <div id="previewContainer" class="mt-4 grid grid-cols-3 gap-4">
                <!-- Image previews will appear here -->
            </div>
        </div>

        <!-- Submit Button -->
        <div class="pt-4">
            <button type="submit"
                    class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                Add Product
            </button>
        </div>

    </form>

</div>

<!-- IMAGE PREVIEW SCRIPT -->
<script>
const imageInput = document.getElementById("imageInput");
const previewContainer = document.getElementById("previewContainer");

// This will store all selected images
let selectedFiles = [];

imageInput.addEventListener("change", function(event) {

    const newFiles = Array.from(event.target.files);

    newFiles.forEach(file => {
        selectedFiles.push(file);
    });

    renderPreviews();
});

// Renders all previews
function renderPreviews() {
    previewContainer.innerHTML = "";

    selectedFiles.forEach((file, index) => {

        const reader = new FileReader();

        reader.onload = function(e) {

            const wrapper = document.createElement("div");
            wrapper.className = "relative border rounded p-2 bg-gray-50";

            const img = document.createElement("img");
            img.src = e.target.result;
            img.className = "w-full h-32 object-cover rounded shadow";

            // Remove Button
            const removeBtn = document.createElement("button");
            removeBtn.innerHTML = "âœ–";
            removeBtn.className = "absolute top-1 right-1 bg-red-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-700";
            removeBtn.onclick = () => removeImage(index);

            wrapper.appendChild(img);
            wrapper.appendChild(removeBtn);
            previewContainer.appendChild(wrapper);
        };

        reader.readAsDataURL(file);
    });

    updateFileInput();
}

// Remove image
function removeImage(index) {
    selectedFiles.splice(index, 1);
    renderPreviews();
}

// Update input file list
function updateFileInput() {
    const dataTransfer = new DataTransfer();

    selectedFiles.forEach(file => {
        dataTransfer.items.add(file);
    });

    imageInput.files = dataTransfer.files;
}
</script>

{% endblock %}
